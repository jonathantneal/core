"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ELEMENT_PREFIX="element-",ELEMENT_COLLECT="element-collect",ELEMENT_MASTER="element-master",ELEMENT_CONTEXT="element-context";function root(t){return t.shadowRoot||t}function remove(t,e){root(t).removeChild(e)}function append(t,e){root(t).appendChild(e)}function replace(t,e,s){root(t).replaceChild(e,s)}function h(t,e,...s){return new VDom(t,e,concat(s))}class VDom{constructor(t,e,s){this.tag=t,this.props=e||{},this.children=s||[]}clone(t=this.tag,e=this.props,s=this.children){return new VDom(t,Object.assign({},e),s)}}function isDom(t){return null!==t&&"object"==typeof t&&11!==t.nodeType}function isVDom(t){return"object"==typeof t&&t instanceof VDom}function concat(t,e=[]){for(let s=0;s<t.length;s++){let n=t[s];Array.isArray(n)?concat(n,e):e.push(isVDom(n)?n:new VDom("",{},[n||""]))}return e}function diff(t,e,s,n={},o,r){let i=e&&e[ELEMENT_MASTER]||new VDom,l=e,c=s;if(s){let c="slot"===s.tag;if(s=slot(s,n),i=slot(i,n),r=r||"svg"===s.tag,t&&i.tag!==s.tag)if(l=isDom(s.tag)?s.tag:s.tag?r?document.createElementNS("http://www.w3.org/2000/svg",s.tag):document.createElement(s.tag):document.createTextNode(""),e)for(replace(t,l,e);!c&&!s.collect&&e.firstChild;)append(l,e.firstChild);else append(t,l);if(3===l.nodeType)i.children[0]!==s.children[0]&&(l.textContent=s.children[0]);else{l&&l[ELEMENT_CONTEXT]&&(o=l[ELEMENT_CONTEXT](o));let e=t&&l[ELEMENT_COLLECT]||{},h=diffProps(l,s.tag===i.tag?i.props:{},s.props,r,e.props);if(e.handler)h.children=s.children.map(t=>t.tag?t:t.children[0]),e.handler(h);else if(!c&&l){let t=Array.from((l.shadowRoot||l).childNodes),e=Math.max(t.length,s.children.length);for(let i=0;i<e;i++)diff(l,t[i],s.children[i],n,o,r)}}}else t&&e&&remove(t,e);return l[ELEMENT_MASTER]=c,l}function Collect(t,e,s){this.observer=t[ELEMENT_COLLECT]={props:e,handler:s}}function Context(t,e,s="context"){t[ELEMENT_CONTEXT]=(n=>t[s]=e(n)||n)}function diffProps(t,e,s,n,o){let r=Object.keys(e).concat(Object.keys(s)),i=r.length,l={};for(let c=0;c<i;c++){let i=r[c];if((!n||"xmlns"!==i)&&e[i]!==s[i]){if(o&&o.indexOf(i)>-1){l[i]=s[i];continue}let r="function"==typeof s[i],c="function"==typeof e[i];if(r||c)c&&t.removeEventListener(i,e[i]),r&&t.addEventListener(i,s[i]);else if(i in s)if(i in t&&!n||n&&"style"===i)if("style"===i)if("object"==typeof s[i]){let n=e[i]||{},o=s[i];for(let e in o)n[e]!==o[e]&&("-"===e[0]?t.setProperty(e,o[e]):t.style[e]=o[e]);s[i]=Object.assign({},n,o)}else t.style.cssText=s[i];else t[i]=s[i];else n?t.setAttributeNS(null,i,s[i]):t.setAttribute(i,s[i]);else o?s[i]=e[i]:t.removeAttribute(i)}}return l}function slot(t,e){return"slot"===t.tag?(delete(t=t.clone(e[t.props.name]||"")).props.name,t):t}function camelCase(t){return t.replace(/-+([\w])/g,(t,e)=>e.toUpperCase())}function defer(t){return Promise.resolve().then(t)}function getProps(t){let e=Array.isArray(t);return{keys:(e?t:Object.keys(t)).concat("children"),types:e?{}:t}}class Element extends HTMLElement{constructor(){super(),this.props={},this.slots={},this.state={},this.preventRender=!0,this.is=this.nodeName.toLocaleLowerCase(),this._props=getProps(this.constructor.props),new Collect(this,this._props.keys,t=>this.setProperties(t)),new Context(this,t=>this.getContext(t))}get content(){return this.shadowRoot||this}static get props(){return[]}static get observedAttributes(){return getProps(this.props).keys}setAttribute(t,e){this._props.keys.indexOf(t)>-1?this.setProperties({[t]:e}):super.setAttribute(t,e)}setProperties(t){let e={},s=this.isMounted;for(let s in t){let n,o=this._props.types[s],r=t[s];r=o?o(r):r,n=camelCase(s),r!==this.props[n]&&(e[n]=r)}Object.keys(e).length&&(s&&(s=!1!==this.onUpdate(e)),this.props=Object.assign({},this.props,e),s&&this.setState({}))}setState(t,e){"object"==typeof t&&(this.state=Object.assign({},this.state,t),this.preventRender||(this.preventRender=!0,defer(()=>{let t=this.render();diff(!1,this,(t=isVDom(t)&&"host"===t.tag?t:h("host",{},t)).clone(this.is),this.slots,this.context),this.preventRender=!1,e?e():this.onUpdated()})))}connectedCallback(){defer(()=>{let t=document.createDocumentFragment();for(;this.firstChild;){let e=this.firstChild,s=e.getAttribute&&e.getAttribute("slot");s&&(this.slots[s]=e),t.appendChild(e)}this.preventRender=!1,this.setState({},()=>{this.isMounted=!0,this.onMounted()})})}disconnectedCallback(){this.onUnmounted()}attributeChangedCallback(t,e,s){e!==s&&this.setProperties({[t]:s})}getContext(){}onMounted(){}onUpdate(){}onUnmounted(){}onUpdated(){}render(){}}exports.Element=Element,exports.h=h;
//# sourceMappingURL=atomico.js.map
